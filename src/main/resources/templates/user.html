<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>
        User information page
    </title>
</head>
<body>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
<!--<script src="users1.js"></script>-->

<script>
    $(document).ready(function () {
        // let url = "http://localhost:8080/getUser";
        getUser();
    });

    async function getUser() {
        /* ваш код */
        let url = "http://localhost:8080/getUser";
        let response = await fetch(url);

        let result = await response.json(); // читать тело ответа в формате JSON

        getLogout(result.currentUser, result.rolesCurrentUser);

        getVerticalPils(result.rolesCurrentUser);

        getAllUsersTable(result.userRoles);
    }

    function getLogout(currentUser, rolesCurrentUser) {
        document.getElementById('userNameLogout').innerHTML = currentUser.name;

        let innerHTML = "<span> with roles :</span>";

        for (let i = 0; i < rolesCurrentUser.length; i++) {
            innerHTML += "&nbsp;<span>" + rolesCurrentUser[i].name + "</span>&nbsp;";
        }
        document.getElementById('userRolesLogout').innerHTML = innerHTML;
    }

    function getVerticalPils(rolesCurrentUser) {
        let innerHTML = "";
        for (let i = 0; i < rolesCurrentUser.length; i++) {
            if (i === 0) {
                innerHTML += "<a class='nav-link active show' id='v-pills-" +
                    rolesCurrentUser[i].name + "-tab' data-toggle='pill' href='#v-pills-" +
                    rolesCurrentUser[i].name + "' aria-selected='true' aria-controls='v-pills-" +
                    rolesCurrentUser[i].name + "' role='tab' value='" + rolesCurrentUser[i].name + "'>";
                innerHTML += "<span>" + rolesCurrentUser[i].name + "</span></a>";
            } else {
                innerHTML += "<a class='nav-link' id='v-pills-" +
                    rolesCurrentUser[i].name + "-tab' data-toggle='pill' href='#v-pills-" +
                    rolesCurrentUser[i].name + "' aria-selected='false' aria-controls='v-pills-" +
                    rolesCurrentUser[i].name + "' role='tab' value='" + rolesCurrentUser[i].name + "'>";
                innerHTML += "<span>" + rolesCurrentUser[i].name + "</span></a>";
            }
        }
        document.getElementById('v-pills-tab').innerHTML = innerHTML;
    }

    function getAllUsersTable(userRoles) {
        let innerHTML = "<label class=\"font-weight-bold\">All user</label>";

        innerHTML += '<table class="table table-striped bg-white border-right border-bottom">';
        innerHTML += '<tr>';
        innerHTML += '        <th>Id</th>';
        innerHTML += '        <th>Name</th>';
        innerHTML += '        <th>Email</th>';
        innerHTML += '        <th>Role</th>';
        innerHTML += '</tr>';

        for (let i = 0; i < userRoles.length; i++) {
            innerHTML += '<tr>';
            innerHTML += '<td>' + userRoles[i].user.id + '</td>';
            innerHTML += '<td>' + userRoles[i].user.name + '</td>';
            innerHTML += '<td>' + userRoles[i].user.email + '</td>';
            innerHTML += '        <td>';
            for (let j = 0; j < userRoles[i].roles.length; j++) {
                innerHTML += '                <label>' + userRoles[i].roles[j].name + '</label>';
            }
            innerHTML += '        </td>';

            innerHTML += '</tr>';
        }
        innerHTML += '</table>';
        document.getElementById('tableAllUser').innerHTML = innerHTML;
    }
</script>


<div class="container-fluid">
    <div class="row bg-dark text-white">
        <div class="col-5">
            <th:block>
                <span class="font-weight-bold" id="userNameLogout" name="userNameLogout"></span>
            </th:block>
            <span id="userRolesLogout" name="userRolesLogout"></span>
        </div>
        <div class="col-6">
        </div>
        <div class="col">
            <a th:href="@{/logout}">Logout</a>
        </div>
    </div>
</div>

<!--Вертикалье подушки pils для переключение между ролями-->
<div class="container-fluid">
    <div class="row">
        <div class="col-2">
            <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
            </div>
        </div>

        <div class="col-10 bg-light">
            <div class="tab-content" id="v-pills-tabContent">
                <div class="container-fluid bg-light" id="tableAllUser">
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>